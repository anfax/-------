
# slurm 投递任务脚本

这是一个用于向集群提交作业的shell脚本，它使用SLURM工作负载管理器。它为作业指定了一些参数，比如节点数、每个节点的任务数、分区、错误和输出文件。它还为Intel编译器设置了环境，并打印了一些关于作业的信息。然后它在划分空间上创建了一个临时目录，并将当前工作目录中的文件复制到其中。它使用OpenMP运行可执行文件`a.out`，并将线程数设置为每个节点的任务数。最后，它将结果复制回工作目录并删除临时目录。

下面是对脚本每一行的解释：

- `#!/bin/sh`这叫做shebang行。它告诉系统使用什么解释器来执行这个脚本。在这种情况下，它是`sh`，这是一个可以执行命令的shell程序。
- `#SBATCH --nodes=1 --ntasks-per-node=20` 这是一个SLURM指令，它告诉调度器为这个作业分配一个节点和每个节点20个任务。任务是可以由处理器执行的工作单元。
- `#SBATCH --partition=n20` 这是另一个SLURM指令，它告诉调度器使用名为`n20`的分区，这是一组具有某些特征的节点。
- `#SBATCH --error=%J.stderr` 这是另一个SLURM指令，它告诉调度器将作业的标准错误输出重定向到以作业ID命名的文件，扩展名为`.stderr`。
- `#SBATCH --output=%J.stdout` 这是另一个SLURM指令，它告诉调度器将作业的标准输出重定向到以作业ID命名的文件，扩展名为`.stdout`。
- `# Assuming that you will use 64 bit compiler` 这是一个注释行，以`#`开头。它不影响脚本的执行，但它为人类读者提供了一些信息或解释。
- `source /apps/intel/2018u2/bin/compilervars.sh intel64` 这是一个命令，它源（或执行）另一个名为`compilervars.sh`的脚本，从一个特定的路径。这个脚本为使用64位架构的Intel编译器设置了一些环境变量。
- `echo "--------------------------------------------------------"` 这是一个命令，它打印一行破折号到标准输出。`echo`命令打印引号内或引号外的任何内容。
- `echo "  JOBID: $SLURM_JOB_ID"` 这是另一个echo命令，打印这个作业的作业ID。`$SLURM_JOB_ID`是一个环境变量，当作业被提交时由SLURM设置。它可以用来标识或引用这个作业。
- `echo "  The job was started at date"` 这是另一个echo命令，打印作业开始时的日期和时间。反引号内的`date`命令执行并返回当前日期和时间作为字符串。
- `echo "  The job was running at $SLURM_JOB_NODELIST "` 这是另一个echo命令，打印为这个作业分配的节点列表。`$SLURM_JOB_NODELIST`是另一个环境变量，当作业被分配时由SLURM设置。它可以用来检查或监控这个作业使用了哪些节点。
- `TMPDIR=/scr/tmp/$USER/$SLURM_JOB_ID` 这是一个命令，它给一个名为`TMPDIR`的变量赋值。值是一个路径，由`/scr/tmp/`、用户名（`$USER`）和作业ID（`$SLURM_JOB_ID`）组成。这个变量稍后将用于在划分空间上创建和访问临时目录。
- `mkdir -p $TMPDIR` 这是一个命令，它创建了一个由`$TMPDIR`指定的路径的目录。 `-p`选项告诉它沿途创建任何缺失的父目录。
●`WORKDIR`的变量赋值。值是`$PWD`，这是一个环境变量，它保存了当前工作目录。这个变量稍后将用于从这个目录复制文件和复制文件到这个目录。
●`\cp -rf $WORKDIR/* $TMPDIR` 这是一个命令，它将所有文件（`*`）从$WORKDIR复制到$TMPDIR。\cp命令前面有一个反斜杠（`\`），它告诉它使用系统的复制命令，而不是可能由用户或系统定义的任何别名或函数。 `-r`选项告诉它递归地复制，意味着它也会复制任何子目录及其内容。 -f选项告诉它强制覆盖任何已存在的文件，而不提示。
●`cd $TMPDIR` 这是一个命令，它将当前工作目录更改为`$TMPDIR`。 `cd`命令代表更改目录。
●`# Run openmp Job` 这是另一个注释行，以#开头。它说明了接下来要做的事情。
●`export OMP_NUM_THREADS=$SLURM_NTASKS_PER_NODE` 这是一个命令，它导出（或设置）一个名为`OMP_NUM_THREADS`的环境变量。值是每个节点的任务数（`$SLURM_NTASKS_PER_NODE`），这也是一个由SLURM设置的环境变量。这个变量用于指定OpenMP并行程序使用的线程数。
●`ulimit -m unlimited` 这是一个命令，它设置了内存使用量的限制为无限。 `ulimit`命令用于控制系统资源的使用限制。 `-m`选项指定内存限制。
●`ulimit -s unlimited` 这是另一个命令，它设置了堆栈大小的限制为无限。堆栈是一种用于存储函数调用和局部变量的内存区域。 -s选项指定堆栈限制。
●`./a.out` 这是一个命令，它运行可执行文件a.out。这个文件应该是由Intel编译器编译的OpenMP程序。 ./表示当前目录。
●`\cp -rf $TMPDIR/* $WORKDIR` 这是一个命令，它将所有文件（*）从临时目录（`$TMPDIR`）复制回工作目录（`$WORKDIR`）。这样可以保留作业的结果和输出文件。
●`# Delete the tmp File` 这是另一个注释行，以`#`开头。它说明了接下来要做的事情。
●`rm -rf $TMPDIR` 这是一个命令，它删除了临时目录（`$TMPDIR`）及其内容。 `rm`
 
- `WORKDIR`的变量赋值。值是`$PWD`，这是一个环境变量，它保存了当前工作目录。这个变量稍后将用于从这个目录复制文件和复制文件到这个目录。 - `\cp -rf $WORKDIR/* $TMPDIR` 这是一个命令，它将所有文件（`*`）从`$WORKDIR`复制到`$TMPDIR`。`\cp`命令前面有一个反斜杠（`\`），它告诉它使用系统的复制命令，而不是可能由用户或系统定义的任何别名或函数。 `-r`选项告诉它递归地复制，意味着它也会复制任何子目录及其内容。 `-f`选项告诉它强制覆盖任何已存在的文件，而不提示。 - `cd $TMPDIR` 这是一个命令，它将当前工作目录更改为`$TMPDIR`。 `cd`命令代表更改目录。 - `# Run openmp Job` 这是另一个注释行，以`#`开头。它说明了接下来要做的事情。 - `export OMP_NUM_THREADS=$SLURM_NTASKS_PER_NODE` 这是一个命令，它导出（或设置）一个名为`OMP_NUM_THREADS`的环境变量。值是每个节点的任务数（`$SLURM_NTASKS_PER_NODE`），这也是一个由SLURM设置的环境变量。这个变量用于指定OpenMP并行程序使用的线程数。 - `ulimit -m unlimited` 这是一个命令，它设置了内存使用量的限制为无限。 `ulimit`命令用于控制系统资源的使用限制。 `-m`选项指定内存限制。 - `ulimit -s unlimited` 这是另一个命令，它设置了堆栈大小的限制为无限。堆栈是一种用于存储函数调用和局部变量的内存区域。 `-s`选项指定堆栈限制。 
- `./a.out` 这是一个命令，它运行可执行文件`a.out`。这个文件应该是由Intel编译器编译的OpenMP程序。 `./`表示当前目录。 

- `\cp -rf $TMPDIR/* $WORKDIR` 这是一个命令，它将所有文件（`*`）从临时目录（`$TMPDIR`）复制回工作目录（`$WORKDIR`）。这样可以保留作业的结果和输出文件。 - `# Delete the tmp File` 这是另一个注释行，以`#`开头。它说明了接下来要做的事情。 - `rm -rf $TMPDIR` 这是一个命令，它删除了临时目录（`$TMPDIR`）及其内容。 `rm`
